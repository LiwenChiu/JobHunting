@{
    ViewData["Title"] = "會員中心";
}
@section Styles {
    <style>
        .card-title {
            font-size: 20px;
        }
    </style>
}
@* <div class="row mt-2" style="width:40%;margin-right:auto; ">
    <label class="col-md-4 form-lable">篩選關鍵字:</label>
    <input class="col-md-8" v-model.lazy="filter" placeholder="請輸入篩選關鍵字" v-on:keyup="filterOpenings()" />
</div> *@
@* 通知 *@


<div id="createOpening">
    <div class="pt-2 px-1 bg-blanchedalmond" style="position: relative">
        <template v-if="alertStatus == '成功'">
            <div id="alert" class="alert alert-primary alert-dismissible fade show" role="alert" style="position: absolute; z-index:100;">
                <strong>{{alertText}}</strong>
                <button type="button" class="btn-close" aria-label="Close" v-on:click="alertStatus=''"></button>
            </div>
        </template>
        <template v-else-if="alertStatus == '失敗'">
            <div id="alert" class="alert alert-danger alert-dismissible fade show" role="alert" style="position: absolute; z-index:100;">
                <strong>{{alertText}}</strong>
                <button type="button" class="btn-close" aria-label="Close" v-on:click="alertStatus=''"></button>
            </div>
        </template>
    </div>
    @* 新增職缺 *@
    <div class="container-fluid py-1 mt-5">
        <div class="letters row">
            <div class="col-md-3 mb-4">
                <a href="#" data-bs-toggle="modal" data-bs-target="#insertmodelID" style="text-decoration:none;">
                    <div class="card" style="width: 16rem; height: 16rem;">
                        <div class="card-body">
                            <h2 class="text-center mt-5">
                                新增<br />職缺
                            </h2>
                        </div>
                    </div>
                </a>
            </div>
            @* 職缺card *@
            <div class="col-md-3 mb-4" v-for="item in openings.slice(pageStart,pageEnd)">
                <div class="card" style="width: 16rem; height: 16rem;">
                    <div class="card-body">
                        <div class="row">
                            <div class="col-10">
                                <span class="card-title mb-3">{{item.title}}</span>
                            </div>
                            @* 刪除履歷 *@
                            <div class="col-2">
                                <button type="button" class="btn-close" aria-label="Close" v-on:click="deleteOpening(item)"></button>
                            </div>
                        </div>
                        <p class="card-text"><i class="fa-solid fa-caret-right mt-2"></i> 工作地點 : {{item.address}}</p>
                        <p class="card-text"><i class="fa-solid fa-caret-right"></i> 工作時間 : {{item.time}}</p>
                        @* 履歷內容按鈕 *@
                        <div class="text-center">
                            <button type="button" data-bs-toggle="modal"
                                    :data-bs-target="'#'+mergeID(item)" class="btn btn-primary">
                                詳細
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            @* 新增職缺modal *@
            <div class="modal fade"
                 id="insertmodelID"
                 tabindex="-1"
                 data-bs-backdrop="static"
                 data-bs-keyboard="false"
                 role="dialog"
                 aria-labelledby="modalTitleId"
                 aria-hidden="true">
                <div class="modal-dialog modal-dialog-scrollable modal-dialog-centered modal-xl"
                     role="document">
                    <div class="modal-content col-md-4">
                        <div class="modal-header" style="background-color: #f7d179;">
                            <h5 class="modal-title text-center" id="modal" style="width:95% ;">
                                新增職缺
                            </h5>
                            <button type="button"
                                    class="btn-close"
                                    data-bs-dismiss="modal"
                                    aria-label="Close"
                                    style="width:5% ;" v-on:click="TagCheckedOpening=[]">
                            </button>
                        </div>
                        <div class="modal-body">
                            <div class="container-fluid">
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <label class="">職缺名稱:</label>
                                            <input type="text" class="form-control" name="title" value="" placeholder="請輸入職缺名稱" v-model="Title" />
                                            <label class="">公司名稱:</label>
                                            <p>{{openings.companyName}}</p>
                                            <label class="">工作地點:</label>
                                            <input type="text" class="form-control" name="Address" value="" placeholder="請輸入地址" v-model="Address" />
                                            <label class="">連絡人:</label>
                                            <input type="text" class="form-control" name="ContactName" value="" placeholder="請輸入聯絡人姓名" v-model="ContactName" />
                                            <label class="">連絡電話:</label>
                                            <input type="text" class="form-control" name="ContactPhone" value="" placeholder="請輸入聯絡電話" v-model="ContactPhone" />
                                            <label class="">電子郵件:</label>
                                            <input type="text" class="form-control" name="ContactEmail" value="" placeholder="請輸入聯絡電子郵件" v-model="ContactEmail" />
                                            <label class="">薪資條件:</label>
                                            <div class="">
                                                <input type="text" value="" v-model="SalaryMin" class="text-center" placeholder="最低薪資" />
                                                <span> -- </span>
                                                <input type="text" value="" v-model="SalaryMax" class="text-center" placeholder="最高薪資" />
                                            </div>
                                            <label class="">上班時段:</label>
                                            <input type="text" value="" v-model="Time" class="form-control" />
                                        </div>

                                        <div class="mb-3">
                                            <p>
                                                <label>
                                                    <button class="btn btn-outline-primary " type="button" data-bs-toggle="collapse" data-bs-target="#TitleClassCollapse" aria-expanded="false" aria-controls="TitleClassCollapse">職缺類型</button>
                                                    check: {{TitleClassCheckedOpening}}<label><span class="badge bg-primary" v-for="item in TitleClassCheckedOpening"></span></label>
                                                </label>
                                            </p>
                                            <div class="collapse" id="TitleClassCollapse">
                                                <div class="card card-body">
                                                    <template v-for="item in titleCategory">
                                                        <button class="astext overcard" type="button" data-bs-toggle="collapse" v-bind:data-bs-target="Returnhashtag(ReturnCategoryNameId(item))" aria-expanded="false" v-bind:aria-controls="ReturnCategoryNameId(item)">
                                                            {{item.titleCategoryName}}
                                                            <span class="badge bg-warning" v-if="selectedFilterTitleCategory(item.titleCategoryId,TitleClassChecked) > 0">{{selectedFilterTitleCategory(item.titleCategoryId,TitleClassChecked)}}</span>
                                                        </button>
                                                        <div class="collapse" v-bind:id="ReturnCategoryNameId(item)">
                                                            <div class="row">
                                                                <div class="px-2" v-for="TitleClass in filterTitleCategory(item.titleCategoryId)">
                                                                    <input type="checkbox" v-bind:id="ReturnNameId(TitleClass)" v-bind:value="TitleClass.titleClassId" v-model="TitleClassChecked" />
                                                                    <label v-bind:for="ReturnNameId(TitleClass)">{{TitleClass.titleClassName}}</label>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <hr />
                                                    </template>
                                                    <button class="astext overcard" type="button" data-bs-toggle="collapse" data-bs-target="#otherClass" aria-expanded="false" aria-controls="otherClass">
                                                        其他
                                                        <span class="badge bg-warning" v-if="selectedFilterTitleCategory(0,TitleClassChecked) > 0">{{selectedFilterTitleCategory(0,TitleClassChecked)}}</span>
                                                    </button>
                                                    <div class="collapse" id="otherClass">
                                                        <div class="row">
                                                            <div class="col-2" v-for="TitleClass in filterTitleCategory(0)">
                                                                <input type="checkbox" v-bind:id="ReturnNameId(TitleClass)" v-bind:value="TitleClass.titleClassId" v-model="TitleClassChecked" />
                                                                <label v-bind:for="ReturnNameId(TitleClass)">{{TitleClass.titleClassName}}</label>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <label class="">學歷要求:</label>
                                            <select v-model="selectedDegreeName">
                                                <option value="" selected>--請選擇--</option>
                                                <option v-for="item in DegreeRequired" :value="item.DegreeName">{{item.DegreeName}}</option>
                                            </select>
                                        </div>
                                        <div>
                                            <p>
                                                <label>
                                                    <button class="btn btn-outline-primary " type="button" data-bs-toggle="collapse" data-bs-target="#TagsCollapse" aria-expanded="false" aria-controls="TagsCollapse">能力標籤</button>
                                                    check: {{TagCheckedOpening}}<label><span class="badge bg-primary" v-for="item in TagCheckedOpening"></span></label>
                                                </label>
                                            </p>
                                            <div class="collapse" id="TagsCollapse">
                                                <div class="card card-body">
                                                    <template v-for="item in TagClasses">
                                                        <button class="astext overcard" type="button" data-bs-toggle="collapse" v-bind:data-bs-target="Returnhashtag(ReturnClassNameId(item))" aria-expanded="false" v-bind:aria-controls="ReturnClassNameId(item)">
                                                            {{item.tagClassName}}
                                                            <span class="badge bg-warning" v-if="selectedFilterTagClass(item.tagClassId,TagChecked) > 0">{{selectedFilterTagClass(item.tagClassId,TagChecked)}}</span>
                                                        </button>
                                                        <div class="collapse" v-bind:id="ReturnClassNameId(item)">
                                                            <div class="row">
                                                                <div class="col-4" v-for="Tag in filterTagClass(item.tagClassId)">
                                                                    <input type="checkbox" v-bind:id="ReturnNameId(Tag)" v-bind:value="Tag.tagId" v-model="TagChecked" />
                                                                    <label v-bind:for="ReturnNameId(Tag)">{{Tag.tagName}}</label>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <hr />
                                                    </template>
                                                    <button class="astext overcard" type="button" data-bs-toggle="collapse" data-bs-target="#otherClass" aria-expanded="false" aria-controls="otherClass">
                                                        其他
                                                        <span class="badge bg-warning" v-if="selectedFilterTagClass(0,TagChecked) > 0">{{selectedFilterTagClass(0,TagChecked)}}</span>
                                                    </button>
                                                    <div class="collapse" id="otherClass">
                                                        <div class="row">
                                                            <div class="col-2" v-for="Tag in filterTagClass(0)">
                                                                <input type="checkbox" v-bind:id="ReturnNameId(Tag)" v-bind:value="Tag.tagId" v-model="TagChecked" />
                                                                <label v-bind:for="ReturnNameId(Tag)">{{Tag.tagName}}</label>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <label for="form-textarea" class="col-form-label">福利:</label>
                                            <textarea class="form-control" id="benefits" v-model="Benefits" value="" style="height:100px"></textarea>
                                        </div>
                                        <div class="mb-3">
                                            <label for="form-textarea" class="col-form-label">工作內容:</label>
                                            <textarea class="form-control" id="description" v-model="Description" value="" style="height:300px"></textarea>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3 ">
                                <span class="form-control text-center ">
                                    是否上架：
                                    <select v-model="ReleaseYN" class="btn btn-primary ms-4" disabled>
                                        <option :value="true">上架</option>
                                        <option :value="false">關閉</option>
                                    </select>
                                </span>
                            </div>
                            <div class="modal-footer">
                                <button type="submit" class="btn btn-success " v-on:click="createOpening">新增</button>
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" v-on:click="TagCheckedOpening=[]">取消</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>


            @* 職缺內容Modal *@
            <div class="modal fade" v-for="item in openings"
                 :id="mergeID(item)"
                 tabindex="-1"
                 data-bs-backdrop="static"
                 data-bs-keyboard="false"
                 role="dialog"
                 aria-labelledby="modalTitleId"
                 aria-hidden="true">
                <div class="modal-dialog modal-dialog-scrollable modal-dialog-centered modal-xl"
                     role="document">
                    <div class="modal-content col-md-4">
                        @* 職缺編輯 *@
                        <template v-if="item.edit == true">
                            <div class="modal-header" style="background-color: #f7d179;">
                                <h5 class="modal-title text-center" id="modal" style="width:95% ;">
                                    {{item.title}}
                                </h5>
                                <button type="button"
                                        class="btn-close"
                                        data-bs-dismiss="modal"
                                        aria-label="Close"
                                        style="width:5% ;" v-on:click="TagCheckedOpening=[]">
                                </button>
                            </div>
                            <div class="modal-body">
                                <div class="container-fluid">
                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="mb-3">
                                                <label class="">職缺名稱:</label>
                                                <input type="text" v-model="item.title" class="form-control" />
                                                <label class="">公司名稱:</label>
                                                <p>{{item.companyName}}</p>
                                                <label class="">工作地點:</label>
                                                <input type="text" v-model="item.address" class="form-control" />
                                                <label class="">連絡人:</label>
                                                <input type="text" v-model="item.contactName" class="form-control" />
                                                <label class="">連絡電話:</label>
                                                <input type="text" v-model="item.contactNumber" class="form-control" />
                                                <label class="">電子郵件:</label>
                                                <input type="text" v-model="item.contactEmail" class="form-control" />
                                                <label class="">薪資條件:</label>
                                                <div class="">
                                                    <input type="text" v-model="item.salaryMin" class="text-center" placeholder="最低薪資" />
                                                    <span> -- </span>
                                                    <input type="text" v-model="item.salaryMax" class="text-center" placeholder="最高薪資" />
                                                </div>
                                                <label class="">上班時段:</label>
                                                <input type="text" v-model="item.time" class="form-control" />
                                            </div>
                                            <div class="mb-3">
                                                <label class="">職缺類別:</label>
                                                <select style="width:30%" v-model="selectedtitleClassId">
                                                    <option value="" selected>-----請選擇-----</option>
                                                    <option v-for="item in titleClass" :value="item.titleClassId">{{item.titleclassName}}</option>
                                                </select>
                                                <label class="">學歷要求:</label>
                                                <select v-model="selectedDegreeName">
                                                    <option value="" selected>--請選擇--</option>
                                                    <option v-for="item in DegreeRequired" :value="item.DegreeName">{{item.DegreeName}}</option>
                                                </select>
                                            </div>
                                            <div>
                                                <p>
                                                    <label>
                                                        <button class="btn btn-outline-primary " type="button" data-bs-toggle="collapse" data-bs-target="#TagsCollapse" aria-expanded="false" aria-controls="TagsCollapse">能力標籤</button>
                                                        check: {{TagCheckedOpening}}<label><span class="badge bg-primary" v-for="item in TagCheckedOpening"></span></label>
                                                    </label>
                                                </p>
                                                <div class="collapse" id="TagsCollapse">
                                                    <div class="card card-body">
                                                        <template v-for="(item,index) in TagClasses">
                                                            <button class="astext overcard" type="button" data-bs-toggle="collapse" v-bind:data-bs-target="Returnhashtag(item)" aria-expanded="false" v-bind:aria-controls="item.tagClassName">{{item.tagClassName}}</button>
                                                            <div class="collapse" v-bind:id="item.tagClassName">
                                                                <div>
                                                                    <template class="px-2" v-for="Tag in filterTagClass(item.tagClassId)">
                                                                        <input type="checkbox" v-bind:id="changeTagNameTo(Tag.tagName)" v-bind:value="Tag.tagId" v-model="selectedtitleClassId" />
                                                                        <label v-bind:for="changeTagNameTo(Tag.tagName)">{{Tag.tagName}}</label>
                                                                    </template>
                                                                </div>
                                                            </div>
                                                            <hr />
                                                        </template>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="mb-3">
                                                <label for="form-textarea" class="col-form-label">福利:</label>
                                                <textarea class="form-control" id="benefits" v-model="item.benefits" style="height:100px"></textarea>
                                            </div>
                                            <div class="mb-3">
                                                <label for="form-textarea" class="col-form-label">工作內容:</label>
                                                <textarea class="form-control" id="description" v-model="item.description" style="height:300px"></textarea>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3 ">
                                <span class="form-control text-center ">
                                    是否上架：
                                    <select v-model="item.releaseYN" class="btn btn-primary ms-4">
                                        <option :value="true">上架</option>
                                        <option :value="false">關閉</option>
                                    </select>
                                </span>
                            </div>
                            <div class="modal-footer">
                                <button type="submit" class="btn btn-success " v-on:click="editConfirm(item)">編輯完成</button>
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" v-on:click="cancel(item)">取消</button>
                            </div>
                        </template>
                        @* 職缺顯示 *@
                        <template v-else="item.edit == false">
                            <div class="modal-header" style="background-color: #f7d179;">
                                <h5 class="modal-title text-center" id="modal" style="width:95%">
                                    {{item.title}}
                                </h5>
                                <button type="button"
                                        class="btn-close"
                                        data-bs-dismiss="modal"
                                        aria-label="Close"
                                        style="width:5% ;" v-on:click="TagCheckedOpening=[]">
                                </button>
                            </div>
                            <div class="modal-body">
                                <div class="container-fluid">
                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="mb-3">
                                                <label class="">職缺名稱:</label>
                                                <p>{{item.title}}</p>
                                                <label class="">公司名稱:</label>
                                                <p>{{item.companyName}}</p>
                                                <label class="">工作地點:</label>
                                                <p>{{item.address}}</p>
                                                <label class="">連絡人:</label>
                                                <p>{{item.contactName}}</p>
                                                <label class="">連絡電話:</label>
                                                <p>{{item.contactNumber}}</p>
                                                <label class="">電子郵件:</label>
                                                <p>{{item.contactEmail}}</p>
                                                <label class="">薪資條件:</label>
                                                <p>{{item.salaryMin}} --- {{item.salaryMax}}</p>
                                                <label class="">上班時段:</label>
                                                <p>{{item.time}}</p>
                                            </div>
                                            <div class="mb-3">
                                                <label class="">職缺類別:</label>
                                                <p>
                                                    {{ getTitleClassName(item.titleClassId) }}
                                                </p>
                                                <label class="">學歷要求:</label>
                                                <select v-model="selectedDegreeName">   
                                                    <option value="" selected>--請選擇--</option>
                                                    <option v-for="item in DegreeRequired" :value="item.DegreeName">{{item.DegreeName}}</option>
                                                </select>
                                            </div>
                                            <div>
                                                <p>
                                                    <label>
                                                        <button class="btn btn-outline-primary " type="button" data-bs-toggle="collapse" data-bs-target="#TagsCollapse" aria-expanded="false" aria-controls="TagsCollapse">能力標籤</button>
                                                        check: {{TagCheckedOpening}}<label><span class="badge bg-primary" v-for="item in TagCheckedOpening"></span></label>
                                                    </label>
                                                </p>
                                                <div class="collapse" id="TagsCollapse">
                                                    <div class="card card-body">
                                                        <template v-for="(item,index) in TagClasses">
                                                            <button class="astext overcard" type="button" data-bs-toggle="collapse" v-bind:data-bs-target="Returnhashtag(item)" aria-expanded="false" v-bind:aria-controls="item.tagClassName">{{item.tagClassName}}</button>
                                                            <div class="collapse" v-bind:id="item.tagClassName">
                                                                <div>
                                                                    <template class="px-2" v-for="Tag in filterTagClass(item.tagClassId)">
                                                                        <input type="checkbox" v-bind:id="changeTagNameTo(Tag.tagName)" v-bind:value="Tag.tagId" v-model="TagCheckedOpening" />
                                                                        <label v-bind:for="changeTagNameTo(Tag.tagName)">{{Tag.tagName}}</label>
                                                                    </template>
                                                                </div>
                                                            </div>
                                                            <hr />
                                                        </template>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="mb-3">
                                                <label for="form-textarea" class="col-form-label">福利:</label>
                                                <p style="height:200px">{{item.benefits}}</p>
                                            </div>
                                            <div class="mb-3">
                                                <label for="form-textarea" class="col-form-label">工作內容:</label>
                                                <p style="height:200px">{{item.description}}</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class=" col-md-3 ">
                                <label class="form-control text-center" >是否上架： <span class="btn btn-primary ms-4">{{Openingif(item.releaseYN)}}</span></label>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary " v-on:click="item.edit = true">編輯</button>
                            </div>
                        </template>
                    </div>
                </div>
            </div>


            @* 分頁 *@
            <div>
                <nav aria-label="Page navigation example">
                    <ul class="pagination justify-content-center">
                        <li class="page-item" v-on:click="setPage(currentPage-1)">
                            <a class="page-link" href="#" aria-label="Previous">
                                <span aria-hidden="true">&laquo;</span>
                            </a>
                        </li>
                        <li v-for="item in totalPage" class="page-item" v-on:click="setPage(item)">
                            <a class="page-link" href="#">{{item}}</a>
                        </li>
                        <li class="page-item" v-on:click="setPage(currentPage+1)">
                            <a class="page-link" href="#" aria-label="Next">
                                <span aria-hidden="true">&raquo;</span>
                            </a>
                        </li>
                    </ul>
                </nav>
            </div>
        </div>
    </div>
</div>

@section Scripts
{
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script>
        let VueApp = {
            data() {
                return {
                    baseAddress: "https://localhost:7169",
                    openings: [],
                    filterOpening: [],
                    selectedDegreeName: '',
                    alertText: "",
                    alertStatus: "",
                    //data
                    Title: "",
                    Address: "",
                    ContactName: "",
                    ContactPhone: "",
                    ContactEmail: "",
                    SalaryMax: "",
                    SalaryMin: "",
                    Time: "",
                    Description: "",
                    Benefits: "",
                    ReleaseYN:true,
                    //分頁
                    pageStatus: 0,
                    perpage: 7, //一頁的資料數
                    currentPage: 1,
                    filter: "",

                    ResumeStatus: 1,
                    MessageStatus: 1,
                    DegreeRequired: [
                        { DegreeVal: 1, DegreeName: "博士" },
                        { DegreeVal: 2, DegreeName: "碩士" },
                        { DegreeVal: 3, DegreeName: "大學" },
                        { DegreeVal: 4, DegreeName: "四技" },
                        { DegreeVal: 5, DegreeName: "二技" },
                        { DegreeVal: 6, DegreeName: "二專" },
                        { DegreeVal: 7, DegreeName: "三專" },
                        { DegreeVal: 8, DegreeName: "五專" },
                        { DegreeVal: 9, DegreeName: "高中" },
                        { DegreeVal: 10, DegreeName: "高職" },
                        { DegreeVal: 11, DegreeName: "國中(含)以下" },
                    ],
                    TagClasses: [],
                    Tags: [],
                    TagChecked: [],
                    TagCheckedOpening: [],

                    titleClass: [],
                    titleCategory:[],
                    TitleClassChecked: [],
                    TitleClassCheckedOpening:[],
                    selectedtitleClassId: '',
                };
            },
            computed: {
                totalPage() {
                    return Math.ceil(this.openings.length / this.perpage)
                    //Math.ceil()取最小整數
                },
                pageStart() {
                    return (this.currentPage - 1) * this.perpage
                    //取得該頁第一個值的index
                },
                pageEnd() {
                    return this.currentPage * this.perpage
                    //取得該頁最後一個值的index
                },
            },
            methods: {
                setPage(page) {
                    if (page <= 0 || page > this.totalPage) {
                        return
                    }
                    this.currentPage = page
                },
                changeTagNameTo: function (TagName) {
                    let _this = this;
                    return `${TagName}BindID`;
                },
                changeTitleClassNameTo: function (TitleClassName) {
                    let _this = this;
                    return `${TitleClassName}BindID`;
                },
                filterTagClass: function (ClassID) {
                    let _this = this;
                    return _this.Tags.filter(function (item) {
                        return item.tagClassId == ClassID;
                    });
                },
                filterTitleCategory: function (CategoryID) {
                    let _this = this;
                    return _this.titleClass.filter(function (item) {
                        return item.titleCategoryId == CategoryID;
                    });
                },
                selectedFilterTagClass: function (ClassId, TagChecked) {
                    let _this = this;
                    let counter = 0;
                    for (let i = 0; i < TagChecked.length; i++) {
                        if (this.filterTagClass(ClassId).filter(function (item) {
                            return item.tagId == TagChecked[i];
                        }).length > 0) { counter++; }
                    }
                    return counter;
                },
                selectedFilterTitleCategory: function (titleCategoryId, TitleClassChecked) {
                    let _this = this;
                    let counter = 0;
                    for (let i = 0; i < TitleClassChecked.length; i++) {
                        if (this.filterTitleCategory(titleCategoryId).filter(function (item) {
                            return item.titleClassId == TitleClassChecked[i];
                        }).length > 0) { counter++; }
                    }
                    return counter;
                },
                ReturnNameId: function (item) {
                    let NameId = `NameId${item.tagName}${item.tagId}`;
                    return NameId.replace(" ", "");
                },
                ReturnClassNameId: function (item) {
                    let ClassNameId = `ClassNameId${item.tagClassName}${item.tagClassId}`;
                    return ClassNameId.replace(" ", "");
                },
                Returnhashtag: function (item) {
                    return `#${item}`;
                },
                ReturnCategoryNameId: function (item) {
                    let CategoryNameId = `CategoryNameId${item.titleCategoryName}${item.titleCategoryId}`;
                    return CategoryNameId.replace(" ", "");
                },
                cancel(ResumeD) {
                    return ResumeD.edit = false;
                },
                mergeID(item) {
                    let str = item.title.replace(/\s/g, "");
                    let num = item.openingId;
                    strID = str + num;
                    return strID;
                },
                getTitleClassName(titleClassId) {
                    if (!Array.isArray(titleClassId)) return '未指定';
                    return titleClassId
                        .map(id => {
                            let titleClassItem = this.titleClass.find(item => item.titleClassId === id);
                            return titleClassItem ? titleClassItem.titleClassName : '未指定';
                        })
                        .join(', '); // 用逗號分隔
                },
                //判斷履歷開放狀態
                Openingif(item) {
                    return item == true ? "上架" : "關閉";
                },
                createOpening: function () {
                    let _this = this;
                    let CompanyId = 7;
                    let request = {};
                    request.CompanyId = CompanyId;
                    request.Title = _this.Title;
                    request.Address = _this.Address;
                    request.ContactName = _this.ContactName;
                    request.ContactPhone = _this.ContactPhone;
                    request.ContactEmail = _this.ContactEmail;
                    request.SalaryMax = _this.SalaryMax;
                    request.SalaryMin = _this.SalaryMin;
                    request.Time = _this.Time;
                    request.Description = _this.Description;
                    request.Benefits = _this.Benefits;
                    request.TitleClassId = _this.selectedtitleClassId;

                    fetch("https://localhost:7169/Companies/Openings/CreateOpening", {
                        method: "POST",
                        headers: {
                            "content-type": "application/json",  //告訴伺服器我們發送的是 JSON 格式的數據。
                        },
                        body: JSON.stringify(request)
                    }).then(response => {
                        return response.json()
                    }).then(data => {
                        if (data.success) {
                            alert("新增職缺成功")
                            window.location.reload();
                        } else {
                            alert("新增職缺失敗")
                        }
                    }).catch(err => {
                        console.log(err)
                    })

                },
                editConfirm: function (item) {
                    const Confirmed = confirm("確定要編輯嗎?");
                    if (Confirmed) {
                        this.editOpening(item);
                    } else {
                        alert("已取消編輯");
                    };
                },
                // 編輯職缺並修改資料庫資料
                editOpening: function (item) {
                    let _this = this
                    let request = {}
                    request.OpeningId = item.openingId;
                    request.Title = item.title;
                    request.Address = item.address;
                    request.ContactName = item.contactName;
                    request.ContactPhone = item.contactPhone;
                    request.ContactEmail = item.contactEmail;
                    request.SalaryMax = item.salaryMax;
                    request.SalaryMin = item.salaryMin;
                    request.Time = item.time;
                    request.Benefits = item.benefits;
                    request.Description = item.description;
                    request.ReleaseYN = item.releaseYN;
                    
                    fetch("https://localhost:7169/Companies/Openings/EditOpening", {
                        method: "POST",
                        headers: {
                            "content-type": "application/json",  //告訴伺服器我們發送的是 JSON 格式的數據。
                        },
                        body: JSON.stringify(request)
                    }).then(response => {
                        return response.json()
                        this.ReceiveOpeningData();
                    }).then(data => {
                        alert(data.message);
                    }).catch(err => {
                        alert(err)
                    });
                    item.edit = false;
                },
                ReceiveOpeningData() {
                    fetch("/Companies/Openings/OpeningJson", {
                        method: "GET",
                    }).then(response => {
                        return response.json();
                    })
                        .then(data => {
                            return this.openings = data
                        }).catch(err => {
                            alert(JSON.stringify(err))
                        });

                    axios.get(`${this.baseAddress}/Companies/Openings/TitleClassJson`).then(
                        res => {
                            this.titleClass = res.data;
                        }
                    ).catch(
                        err => { alert(err) }
                    );

                    axios.get(`${this.baseAddress}/Companies/Openings/TitleCategoryJson`).then(
                        res => {
                            this.titleCategory = res.data;
                        }
                    ).catch(
                        err => { alert(err) }
                    );
                        
                    axios.get(`${this.baseAddress}/Companies/Openings/TagJson`).then(
                        res => this.Tags = res.data
                    ).catch(
                        err => { alert(err) }
                    );

                    axios.get(`${this.baseAddress}/Companies/Openings/TagClassJson`).then(
                        res => this.TagClasses = res.data
                    ).catch(
                        err => { alert(err) }
                    );
                },
                // 刪除職缺
                deleteOpening: function (item) {
                    if (item == null) {
                        this.alertText = "請選擇欲刪除方案";
                        this.alertStatus = "失敗";
                    }
                    else {
                        if (confirm("確定要刪除此職缺嗎?")) {
                            axios.post(`${this.baseAddress}/Companies/Openings/DelOpening`, item.openingId, {
                                headers: {
                                    'Content-Type': 'application/json'
                                }
                            }).then(response => {
                                this.alertText = response.data[0];
                                this.alertStatus = response.data[1];
                                this.ReceiveOpeningData();
                            }).catch(err => { alert(err) });
                        }
                        else {
                            this.alertText = "刪除操作已取消";
                            this.alertStatus = "取消";
                        }
                    }
                    this.alertOut();
                },
                alertOut: function () {
                    let time = window.setTimeout((() => this.alertStatus = ""), 5000);
                },
            },
            mounted() {
                this.ReceiveOpeningData();
            },
        }
        let app = Vue.createApp(VueApp).mount("#createOpening");
    </script>
}